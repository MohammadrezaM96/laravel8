//Local storage
function setItem(key, value) {
    sessionStorage.setItem(key, value);
}

function getItem(key) {
    return sessionStorage.getItem(key);
}

function removeItem(key) {
    sessionStorage.removeItem(key);
}

function setItemStorage(key, value) {
    localStorage.setItem(key, value);
}

function getItemStorage(key) {
    return localStorage.getItem(key);
}

function removeItemStorage(key) {
    localStorage.removeItem(key);
}


$(function () {


    // convert to price
    $('.convertPrice').on('keyup', function () {
        var value = numeral($(this).val()).value();
        if (value == null) {
            value = 0;
        }
        $(this).val(numeral(value).format('0,0'));
        if ($('.basePrice').length != 0) {
            $('.basePrice').val(value);
        }
    });


    // keywords-select
    $(".keywords-select").select2({
        // enable tagging
        tags: true,

        // max tags is 3
        // maximumSelectionLength: 3,

        ajax: {
            url: baseAdminUrl + '/search/keyword',
            delay: 500,
            processResults: function (data, page) {
                return {
                    results: data
                };
            }
        }

    });

    // side bar
    var currentClicked = $('.currentClicked');
    currentClicked.addClass('active');
    currentClicked.parents('li').addClass('active');
    currentClicked.parents('li').addClass('active');
    currentClicked.parents('ul.nav-second-level').addClass('collapse in');
    currentClicked.parents('ul.nav-second-level').prev().addClass('active');

    // tooltip and popover
    $('[data-toggle="tooltip"]').tooltip();
    $('[data-toggle="popover"]').popover();

    // date picker

    $('.persianDate').MdPersianDateTimePicker({
        targetTextSelector: '.persianDate',
        fromDate: true,
        enableTimePicker: true,
        groupId: 'rangeSelector1',
        dateFormat: 'yyyy-MM-dd HH:mm:ss',
        textFormat: 'yyyy-MM-dd HH:mm:ss',
    });

    $('.persianDate2').MdPersianDateTimePicker({
        targetTextSelector: '.persianDate2',
        fromDate: true,
        enableTimePicker: true,
        groupId: 'rangeSelector1',
        dateFormat: 'yyyy-MM-dd HH:mm:ss',
        textFormat: 'yyyy-MM-dd HH:mm:ss',
    });

    // toaster config
    toastr.options = {
        "closeButton": true,
        "debug": true,
        "newestOnTop": true,
        "progressBar": true,
        "positionClass": "toast-bottom-left",
        "preventDuplicates": false,
        "showDuration": "4000",
        "hideDuration": "4000",
        "timeOut": "4000",
        "extendedTimeOut": "4000",
        "showEasing": "swing",
        "hideEasing": "linear",
        "showMethod": "fadeIn",
        "hideMethod": "fadeOut"
    }

    // show erors
    var validationError = $('.validation-error');
    $.each(validationError, function () {
        if ($(this).html() != '') {
            toastr["error"]($(this).html())
        }
    });

    // show success message
    if ($('#success-error').html() != undefined) {
        toastr["success"]($('#success-error').html())
    }
    // show error message
    if ($('#danger-error').html() != undefined) {
        toastr["error"]($('#danger-error').html())
    }

    $('input[type=file]').on('change', function () {
        $(this).next().html($(this).val());
    });


    var vars = [],
        hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for (var i = 0; i < hashes.length; i++) {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
    }
    if (vars[0] == 'page' || window.location.href.indexOf('?') > 0) {
        $("html, body").animate({
            scrollTop: $(".table").offset().top - 90
        }, "800", "swing");
    }

    $(".slimscroll-menu").animate({
        scrollTop: $("#side-menu li.active").offset().top - 90
    }, "800", "swing");

    if ($('.summernote-editor').length != 0) {
        $(".summernote-editor").summernote({height: 100, minHeight: null, maxHeight: null, focus: !1});
        $(".summernote-inline").summernote({airMode: !0});
    }
    if ($('.clockpicker').length != 0) {
        $(".clockpicker").clockpicker({donetext: "Ø§Ù†ØªØ®Ø§Ø¨"})
    }


    function hyphen(param) {
        param = param.replace(/([~!@#$%^&*()_+=`{}\[\]\|\\:;'<>,.\/? ])+/g, '-').replace(/^(-)+|(-)+$/g, '-');
        return param;
    }

    $(".baseNameElement").on("input", function () {
        $('.targetLinkElement').val(hyphen($(this).val().trim()));
    });

    $(".targetLinkElement").on("input", function () {
        $('.targetLinkElement').val(hyphen($(this).val()));
    });


    // delete item
    $(".deleteItem").on('click', function () {

        var name = $(this).data('name');
        var warning = $(this).data('warning');
        var csrf = $('input[name=_token]').val();
        var soft = $(this).data('soft');
        if (soft) {
            var msgText = 'Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø²Ø¨Ø§Ù„Ù‡ Ø¯Ø§Ù† : ' + name;
            if (warning == 1) {
                msgText += '<br/> <h6 class="text-danger"> Ø¨Ø§ Ø­Ø°Ù  ' + name + ' ØªÙ…Ø§Ù… Ù…ÙˆØ§Ø±Ø¯ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ù†ÛŒØ² Ø¨Ù‡ Ø²Ø¨Ø§Ù„Ù‡ Ø¯Ø§Ù† Ø§Ù†ØªÙ‚Ø§Ù„ Ø®ÙˆØ§Ù‡Ù†Ø¯ ÛŒØ§ÙØª </h6>';
            }
        } else {
            var msgText = 'Ø­Ø°Ù : ' + name;
            if (warning == 1) {
                msgText += '<br/> <h6 class="text-danger"> Ø¨Ø§ Ø­Ø°Ù  ' + name + ' ØªÙ…Ø§Ù… Ù…ÙˆØ§Ø±Ø¯ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ù†ÛŒØ² Ø­Ø°Ù Ø®ÙˆØ§Ù‡Ù†Ø¯ ÛŒØ§ÙØª </h6>';
            }
        }
        var url = $(this).data('url');

        deleteRow($(this), msgText, url, {
            delete: 1,
            _token: csrf,
            _method: "DELETE"
        });

    });

    /* ckeditor plugin */
    if ($('.ck-editor').length > 0) {

        $('.ck-editor').each(function () {
            CKEDITOR.replace($(this).attr('id'), {
                filebrowserBrowseUrl: baseRoot + "/fileman/index.html",
                filebrowserImageBrowseUrl: baseRoot + '/fileman/index.html?type=image&langCode=fa',
                removeDialogTabs: 'link:upload;image:upload'
            });
        });

    }

    /* ckeditor plugin simple */
    if ($('.ck-editor-simple').length > 0) {
        CKEDITOR.replace($('.ck-editor-simple').attr('id'), {
            filebrowserBrowseUrl: baseRoot + "/fileman/index.html",
            filebrowserImageBrowseUrl: baseRoot + '/fileman/index.html?type=image&langCode=fa',
            removeDialogTabs: 'link:upload;image:upload',
            toolbarGroups: [
                {name: 'tools', groups: ['tools']},
                {name: 'links', groups: ['links']},
                {name: 'insert', groups: ['insert']},
                {name: 'paragraph', groups: ['list', 'indent', 'align']}
            ],
            removeButtons: 'Anchor,Flash,Table,HorizontalRule,Smiley,SpecialChar,PageBreak,Iframe,ShowBlocks,Slider',
            height: 60,
            width: '100%'
        });
    }

    // editPriority
    $('.editPriority').on('click', function () {
        var url = $(this).data('url');
        var parent = $(this).parents('.input-group');
        let params = {
            priority: numeral(parent.find('.changePriority').val()).value(),
            id: $(this).data('id'),
            _token: $('input[name=_token]').val(),
        };
        $.ajax({
            type: "POST",
            url: url,
            data: params,
            success: function (response) {
                location.reload();
            },
            error: function () {
                toastr["error"]('Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡ Ù…ÛŒ Ø¨Ø§Ø´Ø¯');
            }
        });
    });

    // show and close inline edit
    $('.chengeElement').on('click', function () {
        $('.chengeElement').removeClass('d-none');
        $('.chengeElement').next().addClass('d-none');
        $(this).addClass('d-none');
        $(this).next().removeClass('d-none');
    });

    $('.closeChengeElement').on('click', function () {
        var parent = $(this).parents('.input-group');
        parent.addClass('d-none');
        parent.prev().removeClass('d-none');
    });


});

// delete Row
function delete_row(title, text, deleted_text, url, data, callback) {

    $.ajaxSetup({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    });
    swal({
            title: title,
            text: text,
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#b01f37',
            cancelButtonColor: '#d33',
            confirmButtonText: 'بله، حذف کن',
            cancelButtonText: 'انصراف',
            confirmButtonClass: 'btn btn-primary btn-lg mr-1',
            cancelButtonClass: 'btn btn-danger btn-lg',
            buttonsStyling: false,
            allowOutsideClick: true
        })

        .then(function(t) {
        if (t.value == true) {
            // $.ajax({
            //     url: url,
            //     method: 'POST',
            //     data: data,
            //     success: function() {
            //         // increase the trash count
            //         var trashCount = $('#trashCount').html();
            //         if (!trashCount != undefined) {
            //             $('#trashCount').html(Number(trashCount) + 1);
            //         }
            //
            //         swal("Done", "کامنت مورد نظر با موفقیت حذف شد.");
            //
            //         var tbody = elem.parents('tbody')
            //         var checkTr = elem.parents('tr');
            //         console.log(checkTr);
            //         if (checkTr.length == 0) {
            //             setTimeout(function() {
            //                 location.reload();
            //             }, 1500);
            //         } else {
            //             elem.parents('tr').remove();
            //             var check = $('tbody tr');
            //             var countTh = $('thead tr th').length;
            //             var checkAdditionalTr = tbody.find('.additionalTr');
            //             if ((check.length - checkAdditionalTr.length) <= 0) {
            //                 $('tbody').html(`<tr><td colspan="${countTh}" class="alert-danger p-2 text-center">${ window.i18n.common['noResult'] }</td></tr>`);
            //             }
            //         }
            //     },
            //     error: function() {
            //         Swal.fire("Error!", window.i18n.common['errorMsg'], "error");
            //     }
            // });
            $('.preloader').show();
            $.ajax({
                url: url,
                method: 'POST',
                data: data,
                success: function() {
                    $('.preloader').fadeOut();
                    swal({
                        title: 'Deleted',
                        text: deleted_text,
                        type: 'success',
                        confirmButtonText: 'OK',
                        confirmButtonClass: 'btn btn-primary btn-lg',
                        buttonsStyling: false
                    });
                    callback();
                },
                error: function() {
                    $('.preloader').fadeOut();
                    swal({
                        title: 'Problem !',
                        text: 'Problem ',
                        type: 'error',
                        confirmButtonText: 'Ok ',
                        confirmButtonClass: 'btn btn-primary btn-lg',
                        buttonsStyling: false,
                        allowOutsideClick: true
                    });
                }
            });

        }
    })
}

function send_row(title, text, send_text, url, data, callback) {
    swal({
            title: title,
            text: text,
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Ø¨Ù„Ù‡ØŒ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†!',
            cancelButtonText: 'Ø®ÛŒØ±ØŒ Ø§Ù†ØµØ±Ø§Ù!',
            confirmButtonClass: 'btn btn-primary btn-lg mr-1',
            cancelButtonClass: 'btn btn-danger btn-lg',
            buttonsStyling: false,
            allowOutsideClick: true
        },
        function(isConfirm) {
            if (isConfirm === true) {
                $('.preloader').show();
                $.ajax({
                    url: url,
                    method: 'POST',
                    data: data,
                    success: function() {
                        $('.preloader').fadeOut();
                        swal({
                            title: 'Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!',
                            text: send_text,
                            type: 'success',
                            confirmButtonText: 'Ø¨Ø³ØªÙ†',
                            confirmButtonClass: 'btn btn-primary btn-lg',
                            buttonsStyling: false
                        });
                        callback();
                    },
                    error: function() {
                        $('.preloader').fadeOut();
                        swal({
                            title: 'Ø®Ø·Ø§!',
                            text: 'Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³ØªØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.',
                            type: 'error',
                            confirmButtonText: 'Ø¨Ø³ØªÙ†',
                            confirmButtonClass: 'btn btn-primary btn-lg',
                            buttonsStyling: false,
                            allowOutsideClick: true
                        });
                    }
                });
            }
        });
}

function reject_row(title, text, url, data, callback) {
    swal({
            title: title,
            text: text,
            type: 'input',
            showCancelButton: true,
            confirmButtonColor: '#f44236',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Ø¨Ù„Ù‡ Ø±Ø¯ Ù…ÛŒÚ©Ù†Ù…!',
            cancelButtonText: 'Ø¨ÛŒØ®ÛŒØ§Ù„',
            showLoaderOnConfirm: true,
            closeOnConfirm: false,
            closeOnCancel: true,
        },function(inputValue){
            if (inputValue != "") {
                $.ajax({
                    url: url,
                    method: 'POST',
                    data: { id : data.id,username: data.username, reason : inputValue },
                    success: function() {
                        $('.preloader').fadeOut();
                        swal({
                            title: 'Ø¨Ø§ Ø¯Ù„ÛŒÙ„ Ø²ÛŒØ± Ù„ØºÙˆ Ú¯Ø±Ø¯ÛŒØ¯',
                            text: inputValue,
                            type: 'success',
                            confirmButtonText: 'Ø¨Ø³ØªÙ†',
                            confirmButtonClass: 'btn btn-primary btn-lg',
                            buttonsStyling: false
                        });
                        callback();
                    },
                    error: function() {
                        $('.preloader').fadeOut();
                        swal({
                            title: 'Ø®Ø·Ø§!',
                            text: 'Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³ØªØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.',
                            type: 'error',
                            confirmButtonText: 'Ø¨Ø³ØªÙ†',
                            confirmButtonClass: 'btn btn-primary btn-lg',
                            buttonsStyling: false,
                            allowOutsideClick: true
                        });
                    }
                });
            }else{
                swal.showInputError("Ù„Ø·ÙØ§ Ø¯Ù„ÛŒÙ„ Ø±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯");
                return false
            }
        }
    );
}

function alert_row(title, text, url, data, callback) {
    $.ajaxSetup({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    });
    console.log(data.id)
    swal({
            title: title,
            text: text,
            showCancelButton: true,
            confirmButtonColor: '#017709',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes Change',
            cancelButtonText: 'No!',
            showLoaderOnConfirm: true,
            closeOnConfirm: false,
            closeOnCancel: true,
        },function(){
            $.ajax({
                url: url,
                method: 'GET',
                data: { id : data.id},
                success: function(data) {
                    console.log('succes')
                    $('.preloader').fadeOut();
                    swal({
                        title: 'Changed',
                        text: data.result,
                        type: 'success',
                        confirmButtonText: 'Ok',
                        confirmButtonClass: 'btn btn-primary btn-lg',
                        buttonsStyling: false
                    });
                    callback();
                },
                error: function(data) {
                    console.log(data);
                    $('.preloader').fadeOut();
                    swal({
                        title: 'Problem !',
                        text: data.msg,
                        type: 'error',
                        confirmButtonText: 'Ok',
                        confirmButtonClass: 'btn btn-primary btn-lg',
                        buttonsStyling: false,
                        allowOutsideClick: true
                    });
                }
            });
        }
    );
}

function alert_row_back(title, text, url, data, callback) {
    $.ajaxSetup({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    });
    swal({
            title: title,
            text: text,
            showCancelButton: true,
            confirmButtonColor: '#017709',
            cancelButtonColor: '#d33',
            confirmButtonText: 'بله',
            cancelButtonText: 'خیر',
            showLoaderOnConfirm: true,
            closeOnConfirm: false,
            closeOnCancel: true,
        },function(){
            $.ajax({
                url: url,
                method: 'POST',
                data: { id : data.id ,money:data.money,transmoney:data.transmoney},
                success: function(data) {
                    console.log('succes')
                    $('.preloader').fadeOut();
                    swal({
                        title: 'عملیات با موفقیت انجام شد',
                        text: data.result,
                        type: 'success',
                        confirmButtonText: 'اوکی',
                        confirmButtonClass: 'btn btn-primary btn-lg',
                        buttonsStyling: false
                    });
                    callback();
                },
                error: function(data) {
                    console.log(data);
                    $('.preloader').fadeOut();
                    swal({
                        title: 'متاسفانه مشکلی رخ داده است',
                        text: data.msg,
                        type: 'error',
                        confirmButtonText: 'متوجه شدم',
                        confirmButtonClass: 'btn btn-primary btn-lg',
                        buttonsStyling: false,
                        allowOutsideClick: true
                    });
                }
            });
        }
    );
}


function alert_pay_row(title, text,deleteText,url, data, callback) {
    $.ajaxSetup({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        }
    });
    swal({

            title: title,
            text: text,
            type: 'input',

            showCancelButton: true,
            confirmButtonColor: '#007745',
            cancelButtonColor: '#d33',
            confirmButtonText: 'ارسال ',
            cancelButtonText: 'لغو',
            showLoaderOnConfirm: true,
            closeOnConfirm: false,
            closeOnCancel: true,
        },function(inputValue){
            if(inputValue){
                $.ajax({
                    url: url,
                    method: 'POST',
                    data: { id: data.id,reason : inputValue },
                    success: function() {

                        swal({
                            title: ' ارسال شد',
                            text: inputValue,
                            type: 'success',
                            confirmButtonText: 'اوکی',
                            confirmButtonClass: 'btn btn-primary btn-lg',
                            buttonsStyling: false
                        });
                        callback();
                    },
                    error: function() {
                        console.log(inputValue);
                        swal({
                            title: 'مشکل',
                            text: 'مشکلی رخ داده است',
                            type: 'error',
                            confirmButtonText: 'متوجه شدم',
                            confirmButtonClass: 'btn btn-primary btn-lg',
                            buttonsStyling: false,
                            allowOutsideClick: true
                        });
                    }
                });
            }else{
                swal.showInputError(deleteText);
                return false;
            }
        }
    );
}

function all_pay_row(title, text,deleteText,url, data, callback) {
    swal({
            title: title,
            text: text,
            type: 'input',
            showCancelButton: true,
            confirmButtonColor: '#f44236',
            cancelButtonColor: '#d33',
            confirmButtonText: 'ØªØ§ÛŒÛŒØ¯',
            cancelButtonText: 'Ø¨ÛŒØ®ÛŒØ§Ù„',
            showLoaderOnConfirm: true,
            closeOnConfirm: false,
            closeOnCancel: true,
        },function(inputValue){
            if(inputValue){
                $.ajax({
                    url: url,
                    method: 'POST',
                    data: data + "&reason=" + inputValue,
                    success: function() {
                        $('.preloader').fadeOut();
                        callback();
                        swal({
                            title: 'ØªØ§ÛŒÛŒØ¯ Ø´Ø¯',
                            text: inputValue,
                            type: 'success',
                            confirmButtonText: 'Ø¨Ø³ØªÙ†',
                            confirmButtonClass: 'btn btn-primary btn-lg',
                            buttonsStyling: false
                        },function(){
                            location.reload();
                        });
                    },
                    error: function() {
                        $('.preloader').fadeOut();
                        swal({
                            title: 'Ø®Ø·Ø§!',
                            text: 'Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³ØªØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.',
                            type: 'error',
                            confirmButtonText: 'Ø¨Ø³ØªÙ†',
                            confirmButtonClass: 'btn btn-primary btn-lg',
                            buttonsStyling: false,
                            allowOutsideClick: true
                        });
                    }
                });
            }else{
                swal.showInputError(deleteText);
                return false;
            }
        }
    );
}
